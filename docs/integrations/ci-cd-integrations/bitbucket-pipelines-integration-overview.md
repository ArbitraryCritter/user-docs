# Bitbucket Pipelines integration

Snyk integrates with Bitbucket Pipelines using a **Snyk pipe**, seamlessly scanning your application dependencies and Docker images for security vulnerabilities as part of the continuous integration/continuous delivery (CI/CD) workflow.

[Bitbucket Pipes](https://bitbucket.org/blog/meet-bitbucket-pipes-30-ways-to-automate-your-ci-cd-pipeline) enables users to customize and automate a Bitbucket Pipeline CI/CD workflow with a group of ready-to-use tasks that can be added inside of your pipelines by copying and pasting them from the Bitbucket interface.

With the Snyk pipe, you can quickly add Snyk scanning to your pipelines to test and monitor for vulnerabilities at different points of the CI/CD workflow, based on your configurations. Results are then displayed in the Bitbucket Pipelines output view and can also be monitored on the [Snyk Web UI](http://app.snyk.io).

## Snyk pipe information in Bitbucket

From the build directory, Bitbucket Pipelines displays a list of available pipes customized for you, similar to the list in the following screenshot:

![Bitbucket Pipelines list of available pipes](../../.gitbook/assets/uuid-6fff2668-6e2e-22ae-200f-124c8a240b02-en.png)

On this list, find and click **Snyk** to view the pipe, examples, parameters, and values:

![Snyk Scan pipe information](../../.gitbook/assets/mceclip0-25-.png)

## Setup and use details

For setup and use details, see the following pages:

* [Language support for Bitbucket Pipelines integration](bitbucket-pipelines-integration-overview/language-support-for-bitbucket-pipelines-integration.md)
* [Bitbucket Pipelines integration: how it works](bitbucket-pipelines-integration-overview/bitbucket-pipelines-integration-how-it-works.md)
* [Prerequisites for Bitbucket Pipelines integration](bitbucket-pipelines-integration-overview/prerequisites-for-bitbucket-pipelines-integration.md)
* [Configure your Bitbucket Pipelines integration](bitbucket-pipelines-integration-overview.md#configure-your-bitbucket-pipelines-integration)
* [How to add a Snyk pipe](bitbucket-pipelines-integration-overview.md#how-to-add-a-snyk-pipe)
* [Snyk pipe parameters and values (Bitbucket Cloud)](bitbucket-pipelines-integration-overview.md#snyk-pipe-parameters-and-values-bitbucket-cloud)
* [Example of a Snyk pipe for Docker](bitbucket-pipelines-integration-overview/example-of-a-snyk-pipe-for-docker.md)

## Snyk pipe parameters and values (Bitbucket Cloud)

The following is the Snyk pipe that should be configured as part of a pipeline YAML file in order to include vulnerability scanning as part of your CI/CD workflow:

`- pipe: snyk/snyk-scan:0.4.6`

variables:

SNYK\_TOKEN: '' # It is preferable to encrypt this value and enter the string $SNYK\_TOKEN only in the pipeline. See the table that follows for more information.

LANGUAGE: '' # Required unless you use the snyk-cli image

\# IMAGE\_NAME: '' # Only required if LANGUAGE set to 'docker'

\# CODE\_INSIGHTS\_RESULTS: '' # Optional. Default: false

\# SNYK\_TEST\_JSON\_INPUT: "" # Optional. Default: false

\# DONT\_BREAK\_BUILD: '' # Optional

\# MONITOR: '' # Optional

\# SEVERITY\_THRESHOLD: '' # Optional

\# ORGANIZATION: '' # Optional

\# PROJECT\_FOLDER: '' # Optional

\# TARGET\_FILE: '' # Optional

\# EXTRA\_ARGS: '' # Optional

\# DEBUG: '' # Optional

The following table describes the Snyk pipe parameters.

| **Parameter**           | **Description**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| SNYK\_TOKEN (\*)        | <p>Enter the Snyk API token, which you can retrieve from your Snyk Account settings.</p><p>We recommend you encrypt the token: you can add it as a predefined variable in a separate part of the Bitbucket pipes directory:</p><ol><li>From the build directory, navigate to add a new Repository value, name the parameter “SNYK_TOKEN” and enter your API token from Snyk as the value.</li><li><p>From the pipeline YAML file that you're building, enter $SNYK_TOKEN as the value for the SNYK_TOKEN parameter in the Snyk pipe.</p><p><img src="../../.gitbook/assets/uuid-6ce8d058-882c-c810-f303-c59dcaeeeda8-en (3) (3) (3) (3) (3) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (9).png" alt="Snyk_token_in_pipeline.png" data-size="original"></p></li></ol><p>See <a href="https://support.atlassian.com/bitbucket-cloud/resources/">Bitbucket documentation</a> for more information about predefined variables.</p> |
| LANGUAGE (\*)           | <p>Configure the package manager of the app (for example, npm, maven, rubygems, composer, nuget or docker).</p><p>See <a href="https://hub.docker.com/r/snyk/snyk-cli/tags">Dockerhub</a> for a full list of possible tags.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| IMAGE\_NAME (\*)        | For docker language only, configure the image name for which to perform a docker scan.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| CODE\_INSIGHTS\_RESULTS | Create Code Insight report with Snyk test results. Default: \`false\`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| SNYK\_TEST\_JSON\_INPUT | Use if you want to create only a Code Insights report from a previously generated \`snyk test --json\` output. See the example that follows in the section "Generating the Code Insights report from existing Snyk JSON output".                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| DONT\_BREAK\_BUILD      | <p>When set to true, continues the build even when vulnerabilities are discovered.</p><p>Default: false. The build fails.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| MONITOR                 | <p>Records a snapshot of the project for the Snyk UI and then continues monitoring the project after the build is run.</p><p>If the test succeeds, this records a snapshot of the dependencies in the <a href="http://app.snyk.io">Snyk app</a> and allows you to see the state of your deployed code, have it monitored, and receive alerts when new vulnerabilities are found in the code.</p><p>Default: false. The project is not monitored after the initial scan.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| SEVERITY\_THRESHOLD     | <p>Reports issues equal to or higher than the configured level. Possible values: low, med, high, critical</p><p>Default: low. All vulnerabilities are reported.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| ORGANIZATION            | <p>Configures the organization from your Snyk account to which to associate the repository.</p><p>Default: none.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| PROJECT\_FOLDER         | <p>The folder in which the project resides.</p><p>Default: ..</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| TARGET\_FILE            | <p>The package file (for example <code>package.json</code>), equivalent to --file= in the CLI.</p><p>For Docker enter the Dockerfile as the value.</p><p>Default: none.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| EXTRA\_ARGS             | <p>Extra arguments to be passed to the Snyk CLI. Use the parameters and arguments as described here.</p><p>Default: none.</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| DEBUG                   | <p>Turn on extra debug information.</p><p>Default: false</p>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |

{% hint style="info" %}
In order to use a custom API, set the **`SNYK_API` ** environment variable to the URL of the API.
{% endhint %}

### **Example of a Snyk pipe for Docker**

The following is an example of the Snyk pipe set up for a Docker image:

![Snyk pipe for a Docker image](../../.gitbook/assets/uuid-ad76fa92-0b15-da5c-bd27-a1cc250a3ae0-en.png)

### **Example of a Snyk pipe for npm**

The following is an example of the Snyk pipe set up for npm:

![Snyk pipe set up for npm](../../.gitbook/assets/uuid-6e06670a-3217-2ff5-bf56-1e06a309d06c-en.png)
